perfect—这是一份全新的、完整详细的使用说明，已经与我为你改过的 cli_main.py / uploader/douyin_uploader/main.py 完全对齐。保存到项目 README 都没问题。

总览：你现在拥有的能力
✅ 多账号强隔离（推荐）：按别名自动创建独立浏览器资料目录 & 独立 Cookie 备份

Profile：profiles/douyin_<别名>/

Cookie：cookies/douyin_<别名>.json

✅ 一键登录（setup）：扫码后自动落库到上面的 Cookie，后续可跨机迁移

✅ 上传/定时发布：-pt 0 立即发布，或 -pt "YYYY-MM-DD HH:MM" 定时

✅ .txt 辅助文件回落（可选）：同名 .txt 支持四行

标题

话题（逗号/空格或加#都行）

商品链接

商品短标题（≤10 个汉字）

✅ 购物车商品卡：自动切“购物车”、粘贴商品链接、打开“编辑商品”、填短标题、完成编辑

✅ 无头/可视化切换：命令行或环境变量，默认可视化

✅ Cookie 过期自动续期：上传前验证，失效就引导扫码并更新备份

✅ 弹窗兜底：常见“允许/仅本次允许/关闭/我知道了”弹窗自动处理

✅ 调试输出：商品添加失败会在项目根目录生成 add_product_error.png + full_page.html

目录结构（关键）
pgsql
复制
编辑
project-root/
  cli_main.py
  uploader/
    douyin_uploader/
      main.py
  profiles/
    douyin_TZZ/                   ← 自动创建（强隔离浏览器用户目录）
    douyin_shop01/                ← 每个账号一个
  cookies/
    douyin_TZZ.json               ← 自动创建（Cookie 备份）
    douyin_shop01.json
  videos/
    demo.mp4
    demo.txt                      ← 可选：四行内容（标题/话题/商品链接/短标题）
一、首次登录（或切换账号）
bash
复制
编辑
python cli_main.py douyin <别名> setup
# 示例
python cli_main.py douyin TZZ setup
做了什么：

打开可视化浏览器（强隔离目录：profiles/douyin_TZZ/）

你扫码登录一次

登录成功后，自动保存 cookies/douyin_TZZ.json（storageState 备份，用于迁移或兜底）

下次即便换电脑，也可以把 profiles/douyin_TZZ/ + cookies/douyin_TZZ.json 拷过去直接用。

二、最常用的上传命令
1) 立即发布
bash
复制
编辑
python cli_main.py douyin TZZ upload "D:\videos\demo.mp4" -pt 0
不传 -t/-tags/-pu/-ptitle 时，会尝试读取 D:\videos\demo.txt（如果存在）

.txt 四行格式（建议 UTF-8）：

arduino
复制
编辑
男子为了心爱之人每天坚守❤️‍🩹
坚持不懈, 爱情执着, 奋斗使者, 短视频
https://v.douyin.com/xxxxxxx
视频同款
第二行分隔符支持中文逗号/英文逗号/空格，也支持在词前加 #（会自动去掉）

2) 指定标题和话题
bash
复制
编辑
python cli_main.py douyin TZZ upload "D:\videos\demo.mp4" \
  -t "一碗螺蛳粉的治愈力" \
  -tags "美食,夜宵,螺蛳粉" \
  -pt 0
-tags 用逗号分隔（不需要写 #）

3) 定时发布
bash
复制
编辑
python cli_main.py douyin TZZ upload "D:\videos\demo.mp4" -pt "2025-08-20 14:30"
时间格式必须是 "YYYY-MM-DD HH:MM"（你的时区默认是 Asia/Taipei）

4) 带商品卡
bash
复制
编辑
python cli_main.py douyin TZZ upload "D:\videos\demo.mp4" \
  -pt 0 \
  -pu "https://v.douyin.com/xxxxx" \
  -ptitle "视频同款"
如果不传 -ptitle，会自动用标题前 10 个字

也可以把商品信息放在 .txt 的第 3/4 行（如上）

5) 指定封面（可选）
bash
复制
编辑
python cli_main.py douyin TZZ upload "D:\videos\demo.mp4" \
  -pt 0 \
  -thumb "D:\covers\demo.png"
三、无头/可视化切换
两种方式，二选一即可（命令行优先级更高）：

方法 A：命令行
强制无头（后台执行）：--headless

强制可视化：--headed（默认就是可视化）

bash
复制
编辑
python cli_main.py douyin TZZ upload "D:\videos\demo.mp4" -pt 0 --headless
python cli_main.py douyin TZZ upload "D:\videos\demo.mp4" -pt 0 --headed
方法 B：环境变量
HEADLESS=1 → 无头

HEADLESS=0 → 可视化

powershell
复制
编辑
# PowerShell
$env:HEADLESS=1
python cli_main.py douyin TZZ upload "D:\videos\demo.mp4" -pt 0
cmd
复制
编辑
:: CMD
set HEADLESS=0
python cli_main.py douyin TZZ upload "D:\videos\demo.mp4" -pt 0
区别：命令行只影响“这一条命令”，环境变量在当前终端会话里持续生效。两者同时设置时，命令行优先。

四、强隔离（怎么确认已生效）
每个别名会生成 独立的浏览器目录：profiles/douyin_<别名>/

首次 setup / upload 后就能看到对应目录被创建

不同账号的登录态、缓存、站点权限、扩展都互不影响

若你看到多个账号的目录都存在，并且切账号不需要重新登录 = 强隔离已生效

五、Cookie 过期/续期逻辑
上传前先访问上传页，若被重定向到登录页或 5 秒内未达上传页 → 视为失效

若失效：

setup 模式会自动打开浏览器让你扫码，并更新 cookies/douyin_<别名>.json

upload 模式也会触发登录流程：完成后继续当前任务

完成一次上传后，会再次保存最新的 storageState 到 Cookie 备份

六、与 .txt 的合并优先级
CLI 参数优先（你传了 -t/-tags/-pu/-ptitle 就以命令行为准）

没传的项 → 回落到 .txt

.txt 再没有 → 标题默认用“视频文件名”，话题为空，商品为空

七、常见问题 & 排错
提示 Cookie 文件不存在
→ 先跑一次 setup；或确认把 profiles/douyin_<别名>/ 与 cookies/douyin_<别名>.json 从旧机拷过来。

卡在权限弹窗/地理位置
→ 默认代码会尝试“仅本次允许/关闭”。若仍挡住点击，改用 --headed 手动点一次，之后就稳定了。

商品添加失败
→ 程序会在项目根目录输出 add_product_error.png 和 full_page.html。把这俩给我，我能快速对齐定位器。

无头模式失败、可视化成功
→ 说明有时序/动画差异。建议先用可视化跑通，逐步增加 wait_for 稳定性，再切回无头。

八、迁移到另一台电脑（跨机部署）
拷贝这两个东西即可原样使用：

profiles/douyin_<别名>/

cookies/douyin_<别名>.json

然后直接运行（可无头）：

bash
复制
编辑
python cli_main.py douyin <别名> upload "D:\videos\demo.mp4" -pt 0 --headless
九、与 sau_backend / sau_frontend 兼容
CLI 接口未破坏：保留 upload/setup 两种 action 与必填/可选参数

你们后台只需要把账号别名、视频路径、以及可选参数（标题/话题/定时/商品/封面）按上述命令拼接执行

如果你们是通过队列/任务系统调度，建议统一设置 HEADLESS=1（服务器无头），调试时改 --headed

十、命令速查表
bash
复制
编辑
# 登录（扫码）
python cli_main.py douyin TZZ setup

# 立即发布（从同名 .txt 自动读标题/话题/商品）
python cli_main.py douyin TZZ upload "D:\videos\demo.mp4" -pt 0

# 定时发布
python cli_main.py douyin TZZ upload "D:\videos\demo.mp4" -pt "2025-08-20 14:30"

# 指定商品卡
python cli_main.py douyin TZZ upload "D:\videos\demo.mp4" -pt 0 -pu "https://v.douyin.com/xxxxx" -ptitle "视频同款"

# 指定话题与封面
python cli_main.py douyin TZZ upload "D:\videos\demo.mp4" -pt 0 -t "标题" -tags "旅游,美食" -thumb "D:\covers\demo.png"

# 强制无头
python cli_main.py douyin TZZ upload "D:\videos\demo.mp4" -pt 0 --headless
